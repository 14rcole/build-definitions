---
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: show-sbom
spec:
  description: >-
    Shows the Software Bill of Materials (SBOM) file in JSON format generated by CyloneDX tool for the built image.
  params:
    - name: IMAGE_URL
      description: Fully qualified image name to verify.
      type: string
    - name: IMAGE_DIGEST
      description: Image digest.
      type: string
  steps:
  - name: show-sbom
    image: quay.io/redhat-appstudio/hacbs-test:v1.0.12@sha256:8c833349cad40d34262548295cd4eb1bd330e42fbb221ef54e6caee15ae1d208
    env:
      - name: IMAGE_URL
        value: $(params.IMAGE_URL)
      - name: IMAGE_DIGEST
        value: $(params.IMAGE_DIGEST)
    workingDir: $(workspaces.source.path)
    script: |
      #!/usr/bin/env bash

      SBOM_file='./sbom-cyclonedx.json'

      if [ -f "$SBOM_file" ]; then
        echo "SBOM for the built image ${IMAGE_URL}@${IMAGE_DIGEST}"

        cat ./sbom-cyclonedx.json    
      else
        echo "SBOM not found"
      fi
  workspaces:
  - name: source
    description: Workspace containing the source code and SBOM from the build.
